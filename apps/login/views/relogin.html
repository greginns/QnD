<div id='tenant-relogin' class="modal fade" role="dialog" style='z-index: 10000'>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class='row'>
          <div class='col-sm-12'>
            <span style='font-size: 20px; font-weight: bold'>
              Re-Login
            </span>
          </div>
        </div>
      </div>

      <div class="modal-body">
        <div class='row form-group'>
          <div class='col-sm-4'>
            <input type='text' id='tenant-relogin-tenant' class='form-control' placeholder='Tenant' value='{{TID}}' disabled>
          </div>
        </div>
        
        <div class='row form-group'>
          <div class='col-sm-4'>
            <input type='text' id='tenant-relogin-username' class='form-control' placeholder='User Name'>
          </div>
        </div>

        <div class='row form-group'>
          <div class='col-sm-4'>
            <input type='password' id='tenant-relogin-password' class='form-control' placeholder='Password'>
          </div>
        </div>

        <div class='row form-group'>
          <div class='col-sm-12'>
            <span style='color: red' id='tenant-login-error'>
            </span>
          </div>
        </div>

        <div class='row form-group'>
          <div class='col-sm-4'>
            <button class='btn btn-primary' id='tenant-relogin-button'>
              Re-Login
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script type="module">
import {QnD} from '/static/v1/static/lib/client/core/qnd.js';
import {io} from "/static/v1/static/lib/client/core/io.js";

(function() {  
  var opts;
  var modalEl = '#tenant-relogin';

  $('#tenant').on('keyup', key13);
  $('#tenant-relogin-username').on('keyup', key13);
  $('#tenant-relogin-password').on('keyup', key13);
  $('#tenant-relogin-button').on('click', login);

  function key13(ev) {
    if (ev.which == 13) {
      login();
    }
  };

  function login() {
    var username = $('#tenant-relogin-username').val();
    var password = $('#tenant-relogin-password').val();

    $('#tenant-login-error').text('');

    if (!username) {
      $('#tenant-login-error').text('Username is required');
      return;
    }
    
    if (!password) {
      $('#tenant-login-error').text('Password is required');
      return;
    }

    io.post({tenant: '{{TID}}', username, password}, '/login/v1/login/login')
    .then(function(res) {
      if (res.status == 200) {
        opts.cb();
        close();
      }
      else {
        $('#tenant-login-error').text(res.data.errors.message);
      }
    })
    .catch(function(err) {
      alert(err.errMsg)
    })
  }

  function open() {
    $(modalEl).modal({backdrop: 'static', keyboard: false, show: true});
  }

  function close() {
    $(modalEl).modal('hide');
  }

  function popup(popts) {
    opts = popts;
    open();
  }

  QnD.widgets.login = {open};
})();
</script>